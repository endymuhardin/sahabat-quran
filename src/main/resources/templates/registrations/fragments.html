<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>

<!-- Table Fragment for htmx partial updates -->
<div th:fragment="table-content" id="table-content">
    <div th:if="${registrations != null and registrations.hasContent()}">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200" id="registrations-table">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Siswa</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Program</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <tr th:each="reg : ${registrations.content}"
                        th:id="'registration-row-' + ${reg.id}"
                        th:data-registration-id="${reg.id}"
                        class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900" th:text="${reg.fullName}">Nama Siswa</div>
                            <div class="text-sm text-gray-500" th:text="${reg.email}">email@example.com</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900" th:text="${reg.program?.name}">Program</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span th:id="'status-badge-' + ${reg.id}"
                                  class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                  th:classappend="${reg.registrationStatus?.name() == 'SUBMITTED'} ? 'bg-yellow-100 text-yellow-800' : (${reg.registrationStatus?.name() == 'ASSIGNED'} ? 'bg-blue-100 text-blue-800' : (${reg.registrationStatus?.name() == 'APPROVED'} ? 'bg-green-100 text-green-800' : (${reg.registrationStatus?.name() == 'REJECTED'} ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800')))"
                                  th:text="${reg.registrationStatus}">STATUS</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <span th:text="${reg.submittedAt != null} ? ${#temporals.format(reg.submittedAt, 'dd/MM/yyyy')} : '-'">01/01/2024</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <div class="flex justify-end space-x-2">
                                <button th:if="${reg.registrationStatus?.name() == 'SUBMITTED'}"
                                        th:id="'assign-btn-' + ${reg.id}"
                                        type="button"
                                        class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded text-white bg-green-600 hover:bg-green-700"
                                        th:data-registration-id="${reg.id}"
                                        x-on:click="openModalFromButton($el)">
                                    <i class="fas fa-user-plus mr-1"></i>Tugaskan
                                </button>
                                <a th:href="@{'/registrations/' + ${reg.id}}"
                                   th:id="'detail-btn-' + ${reg.id}"
                                   class="inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50">
                                    <i class="fas fa-eye mr-1"></i>Detail
                                </a>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div th:replace="~{registrations/fragments :: pagination}"></div>
    </div>

    <!-- No results message -->
    <div th:unless="${registrations != null and registrations.hasContent()}" id="no-results" class="text-center py-12">
        <div class="text-gray-500">
            <i class="fas fa-inbox text-4xl mb-4"></i>
            <p class="text-lg">Tidak ada registrasi yang ditemukan</p>
            <p class="text-sm">Coba ubah kriteria pencarian Anda</p>
        </div>
    </div>
</div>

<!-- Pagination Fragment -->
<nav th:fragment="pagination" th:if="${registrations != null and registrations.totalPages > 1}"
     class="flex items-center justify-between border-t border-gray-200 px-4 py-3 sm:px-6 mt-4">
    <div class="flex flex-1 justify-between sm:hidden">
        <button th:if="${registrations.hasPrevious()}"
                hx-get="@{/registrations}"
                th:hx-vals="'{ &quot;page&quot;: ' + ${registrations.number - 1} + ' }'"
                hx-target="#table-content"
                hx-swap="outerHTML"
                hx-include="#search-form"
                class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">
            Previous
        </button>
        <button th:if="${registrations.hasNext()}"
                hx-get="@{/registrations}"
                th:hx-vals="'{ &quot;page&quot;: ' + ${registrations.number + 1} + ' }'"
                hx-target="#table-content"
                hx-swap="outerHTML"
                hx-include="#search-form"
                class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">
            Next
        </button>
    </div>
    <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
        <div>
            <p class="text-sm text-gray-700">
                Menampilkan
                <span class="font-medium" th:text="${registrations.number * registrations.size + 1}">1</span>
                -
                <span class="font-medium" th:text="${registrations.number * registrations.size + registrations.numberOfElements}">10</span>
                dari
                <span class="font-medium" th:text="${registrations.totalElements}">100</span>
                hasil
            </p>
        </div>
        <div>
            <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
                <!-- Previous Button -->
                <button th:if="${registrations.hasPrevious()}"
                        hx-get="@{/registrations}"
                        th:hx-vals="'{ &quot;page&quot;: ' + ${registrations.number - 1} + ' }'"
                        hx-target="#table-content"
                        hx-swap="outerHTML"
                        hx-include="#search-form"
                        class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                    <span class="sr-only">Previous</span>
                    <i class="fas fa-chevron-left h-5 w-5"></i>
                </button>
                <span th:unless="${registrations.hasPrevious()}"
                      class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-300 ring-1 ring-inset ring-gray-300 cursor-not-allowed">
                    <span class="sr-only">Previous</span>
                    <i class="fas fa-chevron-left h-5 w-5"></i>
                </span>

                <!-- Page Numbers -->
                <th:block th:each="i : ${#numbers.sequence(0, registrations.totalPages - 1)}">
                    <span th:if="${i == registrations.number}"
                          class="relative z-10 inline-flex items-center bg-green-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600"
                          th:text="${i + 1}">1</span>
                    <button th:unless="${i == registrations.number}"
                            hx-get="@{/registrations}"
                            th:hx-vals="'{ &quot;page&quot;: ' + ${i} + ' }'"
                            hx-target="#table-content"
                            hx-swap="outerHTML"
                            hx-include="#search-form"
                            class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"
                            th:text="${i + 1}">2</button>
                </th:block>

                <!-- Next Button -->
                <button th:if="${registrations.hasNext()}"
                        hx-get="@{/registrations}"
                        th:hx-vals="'{ &quot;page&quot;: ' + ${registrations.number + 1} + ' }'"
                        hx-target="#table-content"
                        hx-swap="outerHTML"
                        hx-include="#search-form"
                        class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                    <span class="sr-only">Next</span>
                    <i class="fas fa-chevron-right h-5 w-5"></i>
                </button>
                <span th:unless="${registrations.hasNext()}"
                      class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-300 ring-1 ring-inset ring-gray-300 cursor-not-allowed">
                    <span class="sr-only">Next</span>
                    <i class="fas fa-chevron-right h-5 w-5"></i>
                </span>
            </nav>
        </div>
    </div>
</nav>

<!-- Single Row Fragment (for updating after assignment) -->
<tr th:fragment="table-row" th:id="'registration-row-' + ${reg.id}"
    th:data-registration-id="${reg.id}"
    class="hover:bg-gray-50">
    <td class="px-6 py-4 whitespace-nowrap">
        <div class="text-sm font-medium text-gray-900" th:text="${reg.fullName}">Nama Siswa</div>
        <div class="text-sm text-gray-500" th:text="${reg.email}">email@example.com</div>
    </td>
    <td class="px-6 py-4 whitespace-nowrap">
        <div class="text-sm text-gray-900" th:text="${reg.program?.name}">Program</div>
    </td>
    <td class="px-6 py-4 whitespace-nowrap">
        <span th:id="'status-badge-' + ${reg.id}"
              class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
              th:classappend="${reg.registrationStatus?.name() == 'SUBMITTED'} ? 'bg-yellow-100 text-yellow-800' : (${reg.registrationStatus?.name() == 'ASSIGNED'} ? 'bg-blue-100 text-blue-800' : (${reg.registrationStatus?.name() == 'APPROVED'} ? 'bg-green-100 text-green-800' : (${reg.registrationStatus?.name() == 'REJECTED'} ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800')))"
              th:text="${reg.registrationStatus}">STATUS</span>
    </td>
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
        <span th:text="${reg.submittedAt != null} ? ${#temporals.format(reg.submittedAt, 'dd/MM/yyyy')} : '-'">01/01/2024</span>
    </td>
    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
        <div class="flex justify-end space-x-2">
            <button th:if="${reg.registrationStatus?.name() == 'SUBMITTED'}"
                    th:id="'assign-btn-' + ${reg.id}"
                    type="button"
                    class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded text-white bg-green-600 hover:bg-green-700"
                    th:data-registration-id="${reg.id}"
                    x-on:click="openModalFromButton($el)">
                <i class="fas fa-user-plus mr-1"></i>Tugaskan
            </button>
            <a th:href="@{'/registrations/' + ${reg.id}}"
               th:id="'detail-btn-' + ${reg.id}"
               class="inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50">
                <i class="fas fa-eye mr-1"></i>Detail
            </a>
        </div>
    </td>
</tr>

<!-- Results Count Badge Fragment -->
<span th:fragment="results-count" id="results-count"
      class="ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full"
      th:text="${registrations?.totalElements ?: 0}">0</span>

</body>
</html>
